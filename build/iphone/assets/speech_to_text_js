function removeNL(e){return e.replace(/(\r\n|\n|\r)/gm,"")}function sendData(e){var t=Ti.Filesystem.getFile(e.path),i=Titanium.Utils.base64encode(t.read()),n={apikey:"developerdemokeydeveloperdemokey",action:"recognize",freeform:"1","content-type":"audio/x-wav",output:"json",audio:removeNL(String(i))},s=JSON.stringify(n);xhr=Titanium.Network.createHTTPClient(),xhr.setRequestHeader("Content-Type","text/plain; charset=utf-8"),xhr.open("POST","http://api.ispeech.org/api/json"),xhr.send(s),xhr.onload=function(){var e=JSON.parse(this.responseText);txtViewDesc.value=null==e.text?"Please try again!":e.text,Ti.API.info(this.responseText)}}Titanium.Media.audioSessionMode=Ti.Media.AUDIO_SESSION_MODE_PLAY_AND_RECORD;var recording=Ti.Media.createAudioRecorder();recording.compression=Ti.Media.AUDIO_FORMAT_LINEAR_PCM,recording.format=Ti.Media.AUDIO_FILEFORMAT_WAVE,Ti.Media.addEventListener("recordinginput",function(e){Ti.API.info("Input availability changed: "+e.available),!e.available&&recording.recording&&b1.fireEvent("click",{})});var file,sound,button=Titanium.UI.createButton({title:"Start Recording",width:128,height:128,bottom:10,left:200});button.addEventListener("click",function(){if(recording.recording)button.title="Start Recording",file=recording.stop(),Ti.Media.stopMicrophoneMonitor(),sendData(file);else{if(!Ti.Media.canRecord)return Ti.UI.createAlertDialog({title:"Error!",message:"No audio recording hardware is currently connected."}).show(),void 0;button.title="Stop Recording",recording.start(),Ti.Media.startMicrophoneMonitor()}}),win1.add(button);